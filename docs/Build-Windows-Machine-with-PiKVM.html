
<!doctype html>
<html lang="en">




<head>
    <title>How to Build Windows Machine with PiKVM - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to Build Windows Machine with PiKVM - Attune Automation">
    <meta name="description"
          content="">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo Build Windows Machine with PiKVM - Attune Automation" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to Build Windows Machine with PiKVM - Attune Automation" />
    <meta name="twitter:description" content="" />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="styles/style.css">

    <!-- Google tag (gtag.js) -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-5TZQZNDJCD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-5TZQZNDJCD');
    </script>
</head>


<body>

<!-- Project NavBar -->

<div class="bg-white border-bottom box-shadow sticky-top mb-3">
<div class="container px-0">
    <div class="row px-0">
        <div class="col d-flex flex-column flex-lg-row align-items-center px-0
            py-3">
            <a class="navbar-brand my-0 mr-lg-auto"
                  href="https://www.servertribe.com/"
                  target="_blank">
                    <img
                        src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                        alt="Attune - Powered by ServerTribe"
                        class="img-fluid navbar-img">
            </a>
            <nav class="my-2 my-lg-0 mr-lg-3">
                <a class="p-2 text-dark" href="http://doc.servertribe.com/"
                   target="_blank">
                    Documentation
                </a>
                <a class="p-2 text-dark"
                   href="https://discord.com/invite/3YpJsagqUn"
                   target="_blank">
                    Discord
                </a>
                <a class="p-2 text-dark" href="https://github.com/Attune-Automation"
                   target="_blank">
                    GitHub
                </a>
                <a class="p-2 text-dark" href="https://www.servertribe.com/learn/"
                   target="_blank">
                    Learn
                </a>
            </nav>
            <a class="btn btn-outline-primary"
               href="https://www.servertribe.com/download-attune-registration/"
               target="_blank">
                Download NOW!
            </a>
        </div>
    </div>
</div></div>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<div class="container px-0">
    <div class="row">
        <nav class="col px-0" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html">
                    PiKVM APIs on Windows
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <strong>Build Windows Machine with PiKVM</strong>
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row">
        <div class="col px-0">
            <h1 class="text-left">
                How to Build Windows Machine with PiKVM
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.com/invite/3YpJsagqUn"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="http://doc.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="toc col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3">
                    <p class="pb-2">
                        <strong>Contents</strong>
                    </p>
                    <p class="text-muted">
                        <a href="#top">
                            <strong>Build Windows Machine with PiKVM</strong>
                        </a>
                    </p>


    
        

                    <p class="text-muted pt-2">
                        <a href="#preparepikvmandstartosinstallation">
                            <strong>Step 1 -</strong> Prepare PiKVM and Start OS Installation
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#testpikvmauthentication">
                            <strong>Step 1.1 -</strong> Test PiKVM Authentication
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#getpikvmsysteminfo">
                            <strong>Step 1.2 -</strong> Get PiKVM System Info
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#getatxstate">
                            <strong>Step 1.3 -</strong> Get ATX State
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#setatxpowersoftoff">
                            <strong>Step 1.4 -</strong> Set ATX Power Soft Off
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#getmsdstate">
                            <strong>Step 1.5 -</strong> Get MSD State
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#disconnectmsdimage">
                            <strong>Step 1.6 -</strong> Disconnect MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#resetmsdstate">
                            <strong>Step 1.7 -</strong> Reset MSD State
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#removemsdimage">
                            <strong>Step 1.8 -</strong> Remove MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#uploadmsdimage">
                            <strong>Step 1.9 -</strong> Upload MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#selectmsdimage">
                            <strong>Step 1.10 -</strong> Select MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#connectmsd">
                            <strong>Step 1.11 -</strong> Connect MSD
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#setatxpoweron">
                            <strong>Step 1.12 -</strong> Set ATX Power On
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#waitforwindowsstartup">
                            <strong>Step 2 -</strong> Wait for Windows Startup
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#waitforwindowsinstallation">
                            <strong>Step 2.1 -</strong> Wait for Windows Installation
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#disconnectmsdimage">
                            <strong>Step 2.2 -</strong> Disconnect MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#removemsdimage">
                            <strong>Step 2.3 -</strong> Remove MSD Image
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#winrmhttps">
                            <strong>Step 2.4 -</strong> WinRM HTTPS
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#pikvmwaitforwindowsstartup">
                            <strong>Step 2.5 -</strong> PiKVM Wait for Windows Startup
                        </a>
                    </p>



                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="jumbotron">
            <p class="display-3 text-center">
                <strong>Automate This</strong>
            </p>
            <p class="lead text-center">
                Use the <strong>Attune GUI</strong> for your Scripts
            </p>
            <p class="lead">
                <ol>
                    <a href="https://www.servertribe.com/download-attune-registration/"
                        target="_blank">
                        <span class="badge badge-primary">1</span>
                        Download Attune
                        <i class="fa-solid fa-download fa-beat-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://github.com/attune-Automation/"
                        target="_blank">
                        <span class="badge badge-primary">2</span>
                         Copy the Attune Project URL
                         <i class="fa-brands fa-github fa-fade"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://servertribe-attune.readthedocs.io/en/latest/howto/design_workspace/clone_project.html"
                        target="_blank">
                        <span class="badge badge-primary">3</span>
                        Clone the Project in Attune
                         <i class="fa-solid fa-book fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=GCWDI29rDV0"
                        target="_blank">
                        <span class="badge badge-primary">4</span>
                        Plan your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=b7DhFcURkZg"
                        target="_blank">
                        <span class="badge badge-primary">5</span>
                        Run your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
            </p>
            <p class="lead text-center">
                You've automated: <strong>Build Windows Machine with PiKVM</strong>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>

        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h3 id="preparepikvmandstartosinstallation">
                            <a href="#preparepikvmandstartosinstallation">
                                <strong>Step 1 -</strong> Prepare PiKVM and Start OS Installation
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="testpikvmauthentication">
                            <a href="#testpikvmauthentication">
                                <strong>Step 1.1 -</strong> Test PiKVM Authentication
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p><strong>HTTP Request: <code>Invoke-WebRequest</code></strong> is used to send an HTTP request to the 
specified URI. The <code>-Headers</code> parameter includes the custom headers.</p>
<p><strong>JSON Parsing:</strong> The response content is converted from JSON using 
<code>ConvertFrom-Json</code>. To pretty-print the output, it's then 
piped into <code>ConvertTo-Json</code>.</p>
<p><strong>Check Response:</strong> The script checks if the <code>ok</code> property in the JSON response 
is <code>true</code>. If not, it prints "Error" and exits with status 1.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via RDP:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
mstsc /admin /v:{automationworkerwindowsnode}
                            </code>
                        </div>
                        <div class="row">
                            <p>
                                Login as user {automationworkerwindowsuseradministrator} and open a
                                command prompt.
                            </p>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/auth/check&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Get

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json

# Check if &#x27;ok&#x27; in response is true
$jsonResponse = $response.Content | ConvertFrom-Json
if ($jsonResponse.ok -ne $true) {
    Write-Host &quot;Error&quot;
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="getpikvmsysteminfo">
                            <a href="#getpikvmsysteminfo">
                                <strong>Step 1.2 -</strong> Get PiKVM System Info
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/info&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Get

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json

# Check if &#x27;ok&#x27; in response is true
$jsonResponse = $response.Content | ConvertFrom-Json
if ($jsonResponse.ok -ne $true) {
    Write-Host &quot;Error&quot;
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="getatxstate">
                            <a href="#getatxstate">
                                <strong>Step 1.3 -</strong> Get ATX State
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/atx&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Get

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="setatxpowersoftoff">
                            <a href="#setatxpowersoftoff">
                                <strong>Step 1.4 -</strong> Set ATX Power Soft Off
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/atx/click?button=power_long&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="getmsdstate">
                            <a href="#getmsdstate">
                                <strong>Step 1.5 -</strong> Get MSD State
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/msd&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Get

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="disconnectmsdimage">
                            <a href="#disconnectmsdimage">
                                <strong>Step 1.6 -</strong> Disconnect MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/msd/set_connected?connected=0&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

try {
    $response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

    # Output the response
    $response.Content | ConvertFrom-Json | ConvertTo-Json
} catch {
    
    Write-Host &quot;An error occurred: $_&quot;

    # Check if the error is &#x27;MsdDisconnectedError&#x27;
    if ($_ -match &#x27;MsdDisconnectedError&#x27;) {
        Write-Host &quot;MSD is disconnected from Server, but should be for this operation&quot;
        exit 0
    }
    
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="resetmsdstate">
                            <a href="#resetmsdstate">
                                <strong>Step 1.7 -</strong> Reset MSD State
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/msd/reset&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="removemsdimage">
                            <a href="#removemsdimage">
                                <strong>Step 1.8 -</strong> Remove MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;
$FILE = &quot;kickstart_{newNode.fqn}.iso&quot;

$uri = &quot;https://$PIKVM/api/msd/remove?image=$FILE&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

try {
    $response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

    # Output the response
    $response.Content | ConvertFrom-Json | ConvertTo-Json
} catch {
    
    Write-Host &quot;An error occurred: $_&quot;

    # Check if the error is &#x27;MsdDisconnectedError&#x27;
    if ($_ -match &#x27;MsdUnknownImageError&#x27;) {
        Write-Host &quot;The image is not found in the storage.&quot;
        exit 0
    }
    
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="uploadmsdimage">
                            <a href="#uploadmsdimage">
                                <strong>Step 1.9 -</strong> Upload MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;
$FILE = &quot;kickstart_{newNode.fqn}.iso&quot;
$ISO_BUILD=&quot;{automationWorkerWindowsBaseDirectory}&quot;
$FilePath=&quot;$ISO_BUILD/$FILE&quot;

Set-Location ${ISO_BUILD}

$FileStream = [System.IO.File]::OpenRead($FilePath)
$FileContent = New-Object Byte[] $FileStream.Length
$FileStream.Read($FileContent, 0, $FileContent.Length)
$FileStream.Close()

$uri = &quot;https://$PIKVM/api/msd/write?image=$FILE&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest `
    -Uri $uri -Headers $headers `
    -Method Post `
    -Body $FileContent `
    -ContentType &quot;application/octet-stream&quot;

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="selectmsdimage">
                            <a href="#selectmsdimage">
                                <strong>Step 1.10 -</strong> Select MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;
$FILE = &quot;kickstart_{newNode.fqn}.iso&quot;

$uri = &quot;https://$PIKVM/api/msd/set_params?image=$FILE&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="connectmsd">
                            <a href="#connectmsd">
                                <strong>Step 1.11 -</strong> Connect MSD
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/msd/set_connected?connected=1&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="setatxpoweron">
                            <a href="#setatxpoweron">
                                <strong>Step 1.12 -</strong> Set ATX Power On
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/atx/power?action=on&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

$response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

# Output the response
$response.Content | ConvertFrom-Json | ConvertTo-Json
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="waitforwindowsstartup">
                            <a href="#waitforwindowsstartup">
                                <strong>Step 2 -</strong> Wait for Windows Startup
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="waitforwindowsinstallation">
                            <a href="#waitforwindowsinstallation">
                                <strong>Step 2.1 -</strong> Wait for Windows Installation
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/hid&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

function NumLock {
    
    try {
        $response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Get
        return $response.result.keyboard.leds.num
    } catch {
        Write-Host &quot;Error occurred: $_&quot;
        return $false
    }
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

Write-Host &quot;Numlock is $(NumLock)&quot;

while ($(NumLock) -eq $false) {
    Write-Host &quot;Waiting for PowerOn&quot;
    Start-Sleep -Seconds 1
}

Write-Host &quot;Numlock is $(NumLock)&quot;

while ($(NumLock) -eq $true) {
    Write-Host &quot;Waiting for WinPE to turn off numlock&quot;
    Start-Sleep -Seconds 5
}

Write-Host &quot;Numlock is $(NumLock)&quot;

while ($(NumLock) -eq $false) {
    Write-Host &quot;Waiting reboot to turn numlock back on again&quot;
    Start-Sleep -Seconds 2
}

Write-Host &quot;Numlock is $(NumLock)&quot;
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="disconnectmsdimage">
                            <a href="#disconnectmsdimage">
                                <strong>Step 2.2 -</strong> Disconnect MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;

$uri = &quot;https://$PIKVM/api/msd/set_connected?connected=0&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

try {
    $response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

    # Output the response
    $response.Content | ConvertFrom-Json | ConvertTo-Json
} catch {
    
    Write-Host &quot;An error occurred: $_&quot;

    # Check if the error is &#x27;MsdDisconnectedError&#x27;
    if ($_ -match &#x27;MsdDisconnectedError&#x27;) {
        Write-Host &quot;MSD is disconnected from Server, but should be for this operation&quot;
        exit 0
    }
    
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="removemsdimage">
                            <a href="#removemsdimage">
                                <strong>Step 2.3 -</strong> Remove MSD Image
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$PIKVM = &quot;{pikvmIpAddress}&quot;
$USER = &quot;{pikvmUserAdmin.user}&quot;
$PASSWORD = &quot;{pikvmUserAdmin.password}&quot;
$FILE = &quot;kickstart_{newNode.fqn}.iso&quot;

$uri = &quot;https://$PIKVM/api/msd/remove?image=$FILE&quot;
$headers = @{
    &quot;X-KVMD-User&quot; = $USER
    &quot;X-KVMD-Passwd&quot; = $PASSWORD
}

# Bypass SSL certificate validation
add-type @&quot;
    using System.Net;
    using System.Security.Cryptography.X509Certificates;
    public class TrustAllCertsPolicy : ICertificatePolicy {
        public bool CheckValidationResult(
            ServicePoint srvPoint, X509Certificate certificate,
            WebRequest request, int certificateProblem) {
            return true;
        }
    }
&quot;@
[System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy

try {
    $response = Invoke-WebRequest -Uri $uri -Headers $headers -Method Post

    # Output the response
    $response.Content | ConvertFrom-Json | ConvertTo-Json
} catch {
    
    Write-Host &quot;An error occurred: $_&quot;

    # Check if the error is &#x27;MsdDisconnectedError&#x27;
    if ($_ -match &#x27;MsdUnknownImageError&#x27;) {
        Write-Host &quot;The image is not found in the storage.&quot;
        exit 0
    }
    
    exit 1
}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="winrmhttps">
                            <a href="#winrmhttps">
                                <strong>Step 2.4 -</strong> WinRM HTTPS
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>












    

    <div class="row">
        <p class="mb-0">
            Check if TCP Port <strong>0</strong> is listening.
        </p>
        <p>Use Telnet to check if the TCP Service is accepting connections.</p>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="pikvmwaitforwindowsstartup">
                            <a href="#pikvmwaitforwindowsstartup">
                                <strong>Step 2.5 -</strong> PiKVM Wait for Windows Startup
                            </a>
                        </h4>
                    </div>











                        <div class="row">
                            <p>
                                Connect via RDP:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
mstsc /admin /v:{newwindowsnode}
                            </code>
                        </div>
                        <div class="row">
                            <p>
                                Login as user {newwindowsnodeuseradministrator} and open a
                                command prompt.
                            </p>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$Start = Get-Date
$count=0

do {
    $pct=$(Get-WmiObject win32_processor | select LoadPercentage).LoadPercentage;
    Write-Host &quot;LoadPercentage: $pct, Count: $count&quot;;
    if ($pct -lt 15) {
        $count += 1;
    } else {
        $count=0
    }
    
    if ( $count -ge 10 ) {
        Write-Host &quot;Wait completed, we were idle for 10 seconds&quot;;
        break;
    }
    
    if ( ( Get-Date ) -gt $Start.AddMinutes(2) ) {
        Write-Host &quot;Wait timed out, we waited two minutes&quot;;
        break;
    }
    
} until ($false);
                </code>
            </pre>
        </div>
    </div>







                    <div class="row pt-5">
                        <div class="col">
                            <h2>Completed</h2>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="toc col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <p class="card-title mt-3 text-center">
                                <strong>Automate with Attune</strong>
                            </p>
                            <p class="card-text text-center">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
              <h1 class="display-4 text-center">
                  Discuss this Project in Discord
              </h1>
              <p class="lead">

                  Join our Discord channel and connect with like-minded individuals who
                  share your passion. Engage in lively discussions, gain valuable insights,
                  and stay updated on the latest trends in our industry. Don't miss out on
                  this opportunity to network, learn, and grow together.
              </p>
              <hr class="my-4 text-center">
                <div class="col px-0">
                  <p class="text-center">
                      Click the link below and become a part of our vibrant community on
                      Discord today!
                  </p>
                  <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://discord.com/invite/3YpJsagqUn"
                       role="button">
                        Join NOW!!!
                    </a>
                  </p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Project Footer -->

<footer class="footer fixed-bottom bg-white border-top box-shadow">
      <div class="container px-0">
          <div class="row">
              <div class="col px-0">
                  <a class="my-0 mr-lg-auto"
                     href="https://www.servertribe.com/"
                     target="_blank">
                      <img
                          src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                          alt="Attune - Powered by ServerTribe"
                          class="img-fluid navbar-img">
                  </a>
              </div>
          </div>
      </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
